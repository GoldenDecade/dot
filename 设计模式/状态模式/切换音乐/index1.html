<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<span id="playMode">顺序播放</span>
<script>
	// 顺序播放 sequentPlay
	// 随机播放 shufflePlay
	// 单曲循环 singlePlay
	// 列表循环 circulationPlay
	const playModeHandler = {
		sequentPlay: function () {
			document.querySelector('#playMode').innerHTML = '顺序播放'
		},
		shufflePlay: function () {
			document.querySelector('#playMode').innerHTML = '随机播放'
		},
		singlePlay: function () {
			document.querySelector('#playMode').innerHTML = '单曲循环'
		},
		circulationPlay: function () {
			document.querySelector('#playMode').innerHTML = '列表循环'
		}
	}
	/*class SequentPlay {
		constructor(self) {
			this._self = self;
		}
		modeSwitch(mode) {
			this._self.setMode(mode);
			this._self._currentMode.handler();
        }
		handler() {
			document.querySelector('#playMode').innerHTML = '顺序播放';
        }
    }
	class ShufflePlay {
		constructor(self) {
			this._self = self;
		}
		modeSwitch(mode) {
			this._self.setMode(mode);
			this._self._currentMode.handler();
		}
		handler() {
			document.querySelector('#playMode').innerHTML = '随机播放';
		}
	}
	class SinglePlay {
		constructor(self) {
			this._self = self;
		}
		modeSwitch(mode) {
			this._self.setMode(mode);
			this._self._currentMode.handler();
		}
		handler() {
			document.querySelector('#playMode').innerHTML = '单曲循环';
		}
	}
	class CirculationPlay {
		constructor(self) {
			this._self = self;
		}
		modeSwitch(mode) {
			this._self.setMode(mode);
			this._self._currentMode.handler();
		}
		handler() {
			document.querySelector('#playMode').innerHTML = '列表循环';
		}
	}*/

	class State {
		constructor(self) {
			this._self = self;
		}
		modeSwitch(mode) {
			this._self.setMode(mode);
			this._self._currentMode.handler();
		}
		handler() {
			console.log('自定义 handler');
		}
    }
	class SequentPlay extends State{
		handler() {
			document.querySelector('#playMode').innerHTML = '顺序播放';
		}
	}
	class ShufflePlay extends State{
		handler() {
			document.querySelector('#playMode').innerHTML = '随机播放';
		}
	}
	class SinglePlay extends State{
		handler() {
			document.querySelector('#playMode').innerHTML = '单曲循环';
		}
	}
	class CirculationPlay extends State{
		handler() {
			document.querySelector('#playMode').innerHTML = '列表循环';
		}
	}

	class PlayMode {
		constructor() {
			this.sequentPlay = new SequentPlay(this);
			this.shufflePlay = new ShufflePlay(this);
			this.singlePlay = new SinglePlay(this);
			this.circulationPlay = new CirculationPlay(this);
			this._mode = [
				this.sequentPlay,
				this.shufflePlay,
				this.singlePlay,
				this.circulationPlay
			]
			this._currentMode = this.sequentPlay;
		}
		setMode(mode) {
			this._currentMode = mode;
			// 2. 触发相应的事件
			this._currentMode.handler();
		}
		changeMode() {
			// 1. mode 改变
			this._currentMode = this._mode[(this._mode.indexOf(this._currentMode) + 1) % this._mode.length];
			// 2. 触发相应的事件
			this._currentMode.handler();
		}
	}
	let playController = new PlayMode();
	playController.setMode(new SinglePlay(playController))
	document.getElementById('playMode').addEventListener('click', function (){
		playController.changeMode();
	}, {
		capture: false,
		once: false, // 如果是 true, listener 会在其调用之后自动移除
		passive: false, // 如果是 true, listener 永远不会调用 preventDefault()
	})

    // pause running restart
</script>
</body>
</html>
